<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PeerJS Multiplayer Game</title>
<style>
    .player {
        width: 50px;
        height: 50px;
        background-color: blue;
        position: absolute;
    }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.2/dist/peerjs.min.js"></script>
<script>
    function generateRandomID() {
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let randomID = '';
        for (let i = 0; i < 5; i++) {
            randomID += characters.charAt(Math.floor(Math.random() * characters.length));
        }
        return randomID;
    }

    let peerID = generateRandomID();
    console.log('My peer ID is: ' + peerID);

    let peer = new Peer(peerID); // Create a new PeerJS instance with the generated ID
    let connections = {}; // To store connections with other peers

    let localPlayer = document.createElement('div');
    localPlayer.className = 'player';
    localPlayer.style.top = '200px';
    localPlayer.style.left = '300px';
    document.body.appendChild(localPlayer);

    function movePlayer(keyCode) {
        const speed = 5;
        const rect = localPlayer.getBoundingClientRect();
        let newX = rect.left;
        let newY = rect.top;

        if (keyCode === 37) { // Left arrow key
            newX -= speed;
        } else if (keyCode === 38) { // Up arrow key
            newY -= speed;
        } else if (keyCode === 39) { // Right arrow key
            newX += speed;
        } else if (keyCode === 40) { // Down arrow key
            newY += speed;
        }

        localPlayer.style.left = newX + 'px';
        localPlayer.style.top = newY + 'px';

        // Send movement data to all connected peers
        for (const peerID in connections) {
            connections[peerID].send({
                keyCode: keyCode,
                position: { x: newX, y: newY }
            });
        }
    }

    document.addEventListener('keydown', (event) => {
        movePlayer(event.keyCode);
    });

    peer.on('open', () => {
        console.log('Peer connection established with ID: ' + peerID);
    });

    peer.on('connection', (conn) => {
        console.log('New connection: ', conn.peer);
        connections[conn.peer] = conn;

        // Create a new player for the connected peer
        let newPlayer = document.createElement('div');
        newPlayer.className = 'player';
        newPlayer.id = conn.peer;
        newPlayer.style.top = '200px';
        newPlayer.style.left = '300px';
        document.body.appendChild(newPlayer);

        conn.on('data', (data) => {
            // Handle data from other peers (if any)
            console.log('Received data from ' + conn.peer + ': ' + JSON.stringify(data));
            // Move the player of the connected peer
            moveOtherPlayer(data, conn.peer);
        });
    });

    function moveOtherPlayer(data, peerID) {
        const speed = 5;
        let otherPlayer = document.getElementById(peerID);

        if (!otherPlayer) return;

        let newX = parseInt(data.position.x);
        let newY = parseInt(data.position.y);

        if (data.keyCode === 37) { // Left arrow key
            newX -= speed;
        } else if (data.keyCode === 38) { // Up arrow key
            newY -= speed;
        } else if (data.keyCode === 39) { // Right arrow key
            newX += speed;
        } else if (data.keyCode === 40) { // Down arrow key
            newY += speed;
        }

        otherPlayer.style.left = newX + 'px';
        otherPlayer.style.top = newY + 'px';
    }

    function connectToPeer(peerID) {
        let conn = peer.connect(peerID);
        connections[peerID] = conn;

        // Create a new player for the connected peer
        let newPlayer = document.createElement('div');
        newPlayer.className = 'player';
        newPlayer.id = peerID;
        newPlayer.style.top = '200px';
        newPlayer.style.left = '300px';
        document.body.appendChild(newPlayer);

        conn.on('open', () => {
            console.log('Connected to peer: ' + peerID);
        });

        conn.on('data', (data) => {
            // Handle data from other peers (if any)
            console.log('Received data from ' + conn.peer + ': ' + JSON.stringify(data));
            // Move the player of the connected peer
            moveOtherPlayer(data, conn.peer);
        });
    }
</script>
</body>
</html>